# RAG ัะธััะตะผะฐ ะดะปั ัะธะฝะฐะฝัะพะฒะพะน ะณัะฐะผะพัะฝะพััะธ

ะกะธััะตะผะฐ Retrieval-Augmented Generation (RAG) ะดะปั ะพัะฒะตัะพะฒ ะฝะฐ ะฒะพะฟัะพัั ะฟะพ ัะธะฝะฐะฝัะพะฒะพะน ะณัะฐะผะพัะฝะพััะธ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ:
- **ะญะผะฑะตะดะดะธะฝะณะธ**: `intfloat/multilingual-e5-small` (ะฑััััะฐั ะผะพะดะตะปั ะดะปั ััััะบะพะณะพ ัะทัะบะฐ)
- **ะะตะบัะพัะฝะฐั ะะ**: FAISS (IndexFlatIP)
- **LLM**: DeepSeek API (deepseek-chat)
- **ะะตััะธะบะธ**: LLM-as-Judge + ROUGE + BERTScore + TF-IDF
- **ะะฝัะตััะตะนั**: Streamlit Web UI

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
finance-news/
โโโ main.py                 # ะัะฝะพะฒะฝะพะน RAG ะฟะฐะนะฟะปะฐะนะฝ (CLI)
โโโ app.py                  # Streamlit ะฒะตะฑ-ะธะฝัะตััะตะนั
โโโ Dockerfile              # ะะพะฝัะธะณััะฐัะธั Docker
โโโ docker-compose.yml      # Docker Compose (web + cli)
โโโ requirements.txt        # Python ะทะฐะฒะธัะธะผะพััะธ
โโโ .env                    # API ะบะปััะธ (ะฝะต ะฒ git)
โโโ .env.example            # ะจะฐะฑะปะพะฝ ะดะปั .env
โโโ train_data.csv          # ะะฐะทะฐ ะทะฝะฐะฝะธะน (679 MB)
โโโ questions.csv           # ะขะตััะพะฒัะต ะฒะพะฟัะพัั
โโโ submission.csv          # ะะตะทัะปััะฐัั ัะฐะฑะพัั
โโโ REPORT.md               # ะััะตั ะพ ัะธััะตะผะต
```

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะพะดะณะพัะพะฒะบะฐ

```bash
# ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone <repo-url>
cd finance-news

# ะกะพะทะดะฐัั .env ัะฐะนะป ั API ะบะปััะพะผ DeepSeek
echo "LLM_API_KEY=sk-your-api-key" > .env
```

### 2. ะะฐะฟััะบ ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ (ัะตะบะพะผะตะฝะดัะตััั)

```bash
# ะกะพะฑัะฐัั ะธ ะทะฐะฟัััะธัั ะฒะตะฑ-ะธะฝัะตััะตะนั
docker-compose up --build

# ะัะบัััั ะฒ ะฑัะฐัะทะตัะต
# http://localhost:8501
```

### 3. ะะฐะฟััะบ CLI ะดะปั batch ะพะฑัะฐะฑะพัะบะธ

```bash
# ะะฐะฟััะบ CLI ัะตะถะธะผะฐ
docker-compose --profile cli run cli

# ะะปะธ ั ะบะฐััะพะผะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ
docker run --rm -v "${PWD}:/app" --env-file .env finance-rag python main.py --mode v3 --limit 50
```

---

## ๐ ะะตะฑ-ะธะฝัะตััะตะนั

Streamlit ะฒะตะฑ-ะธะฝัะตััะตะนั ะฟัะตะดะพััะฐะฒะปัะตั:

### ะคัะฝะบัะธะพะฝะฐะป
- **ะะฒะพะด ะฒะพะฟัะพัะพะฒ**: ะขะตะบััะพะฒะพะต ะฟะพะปะต ะดะปั ะฒะฒะพะดะฐ ะฒะพะฟัะพัะพะฒ ะฟะพ ัะธะฝะฐะฝัะพะฒะพะน ะณัะฐะผะพัะฝะพััะธ
- **ะัะธะผะตัั ะฒะพะฟัะพัะพะฒ**: ะะฝะพะฟะบะธ ั ะณะพัะพะฒัะผะธ ะฟัะธะผะตัะฐะผะธ ะดะปั ะฑััััะพะณะพ ัะตััะธัะพะฒะฐะฝะธั
- **ะัะฑะพั ัะตะถะธะผะฐ**: v1/v2/v3 ั ัะฐะทะฝัะผ ะฑะฐะปะฐะฝัะพะผ ัะบะพัะพััั/ะบะฐัะตััะฒะพ
- **ะะตััะธะบะธ ะบะฐัะตััะฒะฐ**: ะัะพะฑัะฐะถะตะฝะธะต LLM-Judge, ROUGE, BERTScore ะดะปั ะบะฐะถะดะพะณะพ ะพัะฒะตัะฐ
- **ะะพะฝัะตะบัั**: ะัะพัะผะพัั ะฝะฐะนะดะตะฝะฝัั ััะฐะณะผะตะฝัะพะฒ ะธะท ะฑะฐะทั ะทะฝะฐะฝะธะน
- **ะััะพัะธั**: ะกะพััะฐะฝะตะฝะธะต ะฟะพัะปะตะดะฝะธั ะทะฐะฟัะพัะพะฒ

### ะะฐัััะพะนะบะธ
- **Top-K**: ะะพะปะธัะตััะฒะพ ะบะฐะฝะดะธะดะฐัะพะฒ ะดะปั ะฟะพะธัะบะฐ (3-30)
- **Final-K**: ะะพะปะธัะตััะฒะพ ััะฐะณะผะตะฝัะพะฒ ะดะปั ะบะพะฝัะตะบััะฐ (1-5)
- **ะะพะบะฐะท ะบะพะฝัะตะบััะฐ/ะผะตััะธะบ**: ะะฟัะธะพะฝะฐะปัะฝะพะต ะพัะพะฑัะฐะถะตะฝะธะต

### ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
- ะัะพะฒะตัะบะฐ API ะบะปััะฐ ะฟัะธ ััะฐััะต
- ะะฐะปะธะดะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปััะบะพะณะพ ะฒะฒะพะดะฐ
- ะะฝัะพัะผะฐัะธะฒะฝัะต ัะพะพะฑัะตะฝะธั ะพะฑ ะพัะธะฑะบะฐั ะฝะฐ ััััะบะพะผ ัะทัะบะต
- ะะฝะดะธะบะฐัะพั ะทะฐะณััะทะบะธ ัะธััะตะผั

---

## ๐ป ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะะตะฑ-ะธะฝัะตััะตะนั

```bash
# ะกัะฐะฝะดะฐััะฝัะน ะทะฐะฟััะบ
docker-compose up --build

# ะก ะฟะตัะตัะฑะพัะบะพะน ะพะฑัะฐะทะฐ
docker-compose up --build --force-recreate

# ะ ัะพะฝะพะฒะพะผ ัะตะถะธะผะต
docker-compose up -d
```

### CLI ัะตะถะธะผ

```bash
# ะะฑัะฐะฑะพัะฐัั ะฒัะต 500 ะฒะพะฟัะพัะพะฒ ะฒ ัะตะถะธะผะต v3
docker run --rm -v "${PWD}:/app" --env-file .env finance-rag python main.py --mode v3

# ะัััััะน ัะตัั ะฝะฐ 10 ะฒะพะฟัะพัะฐั
docker run --rm -v "${PWD}:/app" --env-file .env finance-rag python main.py --mode v2 --limit 10

# ะะตะถะธะผ v1 ะดะปั baseline ััะฐะฒะฝะตะฝะธั
docker run --rm -v "${PWD}:/app" --env-file .env finance-rag python main.py --mode v1 --limit 30

# ะัะพะฟัััะธัั BERTScore (ะฑััััะตะต)
docker run --rm -v "${PWD}:/app" --env-file .env finance-rag python main.py --mode v2 --skip-bert
```

### ะะตะถะธะผั ัะฐะฑะพัั

| ะะตะถะธะผ | ะะฟะธัะฐะฝะธะต | ะกะบะพัะพััั | ะะฐัะตััะฒะพ |
|-------|----------|----------|----------|
| `v1` | Doc-level ะฒะตะบัะพัะธะทะฐัะธั | ะััััะพ | ะะฐะทะพะฒะพะต |
| `v2` | Chunk-based ะฟะพะธัะบ | ะกัะตะดะฝะต | ะฅะพัะพัะตะต |
| `v3` | Chunk + LLM Reranking | ะะตะดะปะตะฝะฝะพ | ะัััะตะต |

---

## ๐๏ธ ะััะธัะตะบัััะฐ ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโ
โ    ะะพะฟัะพั       โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Sentence-Transformers  โ  โ multilingual-e5-small (384 dim)
โ  (ะปะพะบะฐะปัะฝัะต ัะผะฑะตะดะดะธะฝะณะธ) โ    ะััััะฐั ะผะพะดะตะปั ะดะปั ััััะบะพะณะพ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
         โ embedding (384 dim)
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   FAISS IndexFlatIP     โ  โ ะะตะบัะพัะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั
โ   (ะบะพัะธะฝััะฝะพะต ััะพะดััะฒะพ) โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
         โ top_k ัะตะทัะปััะฐัะพะฒ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Reranker (ัะพะปัะบะพ V3)   โ  โ DeepSeek reranking
โ  DeepSeek-chat          โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
         โ final_k ััะฐะณะผะตะฝัะพะฒ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะตะฝะตัะฐัะธั ะพัะฒะตัะฐ       โ  โ DeepSeek-chat
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะัะตะฝะบะฐ ะบะฐัะตััะฒะฐ        โ  โ ROUGE + BERTScore + LLM-Judge
โ  (ะผัะปััะธ-ะผะตััะธะบะธ)       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐๏ธ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั | ะะตััะธั |
|-----------|------------|--------|
| **Embeddings** | intfloat/multilingual-e5-small | 384 dim |
| **Vector DB** | FAISS (IndexFlatIP) | 1.9.0 |
| **LLM** | DeepSeek API | deepseek-chat |
| **Evaluation** | ROUGE, BERTScore, LLM-Judge | - |
| **Web Interface** | Streamlit | 1.41.0 |
| **Framework** | Python | 3.11 |
| **Infrastructure** | Docker, Docker Compose | - |

---

## ๐ ะะตััะธะบะธ ะบะฐัะตััะฒะฐ

### 1. LLM-as-Judge (ััะฑัะตะบัะธะฒะฝัะต, 1-5)

| ะะตััะธะบะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| **Relevance** | ะะฐัะบะพะปัะบะพ ะพัะฒะตั ัะพะพัะฒะตัััะฒัะตั ะฒะพะฟัะพัั |
| **Faithfulness** | ะัะฝะพะฒะฐะฝ ะปะธ ะพัะฒะตั ะฝะฐ ะบะพะฝัะตะบััะต (ะฑะตะท ะณะฐะปะปััะธะฝะฐัะธะน) |

### 2. ROUGE Scores (ะปะตะบัะธัะตัะบะพะต ัะพะฒะฟะฐะดะตะฝะธะต, 0-1)

| ะะตััะธะบะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| **ROUGE-1** | ะกะพะฒะฟะฐะดะตะฝะธะต ัะฝะธะณัะฐะผะผ |
| **ROUGE-2** | ะกะพะฒะฟะฐะดะตะฝะธะต ะฑะธะณัะฐะผะผ |
| **ROUGE-L** | Longest Common Subsequence |

### 3. BERTScore (ัะตะผะฐะฝัะธัะตัะบะพะต ััะพะดััะฒะพ, 0-1)

| ะะตััะธะบะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| **Precision** | ะขะพัะฝะพััั ัะตะผะฐะฝัะธัะตัะบะพะณะพ ัะพะพัะฒะตัััะฒะธั |
| **Recall** | ะะพะปะฝะพัะฐ ัะตะผะฐะฝัะธัะตัะบะพะณะพ ะฟะพะบัััะธั |
| **F1** | ะะฐัะผะพะฝะธัะตัะบะพะต ััะตะดะฝะตะต P ะธ R |

---

## ๐ง ะัะณัะผะตะฝัั ะบะพะผะฐะฝะดะฝะพะน ัััะพะบะธ (CLI)

| ะัะณัะผะตะฝั | ะะฟะธัะฐะฝะธะต | ะะพ ัะผะพะปัะฐะฝะธั |
|----------|----------|--------------|
| `--mode` | ะะตะถะธะผ RAG (v1/v2/v3) | v2 |
| `--limit` | ะะพะปะธัะตััะฒะพ ะฒะพะฟัะพัะพะฒ | ะฒัะต |
| `--skip-bert` | ะัะพะฟัััะธัั BERTScore | false |

---

## ๐ ะััะพะดะฝัะต ัะฐะนะปั

ะะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั ัะพะทะดะฐัััั:

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `submission.csv` | ะะพะฟัะพัั ั ะพัะฒะตัะฐะผะธ |
| `metrics_detailed.csv` | ะะตัะฐะปัะฝัะต ะผะตััะธะบะธ ะดะปั ะบะฐะถะดะพะณะพ ะฒะพะฟัะพัะฐ |
| `faiss_index_v2_e5small.bin` | FAISS ะธะฝะดะตะบั (ะบัั) |
| `faiss_meta_v2_e5small.pkl` | ะะตัะฐะดะฐะฝะฝัะต ะธะฝะดะตะบัะฐ |

---

## ๐ ะะธัะตะฝะทะธั

MIT License
